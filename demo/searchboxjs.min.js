var SearchBoxJS=function(b){"use strict";const f={searchBoxList:{defaultClassName:"searchBoxList",itemDefaultClassName:"searchBoxList__item",itemButtonDefaultClassName:"searchBoxList__itemButton",messageClassName:"searchBoxList__message",loadingIndicatorClassName:"searchBoxList__loadingIndicator"},searchBoxInput:{defaultClassName:"searchBox__input"}},H={noResultsFound:"Sorry, can't find a match for your search phrase!",loading:"Loading your results\u2026"};class x{constructor(e){this.element=e,this.eventListeners=[]}addListener(e,t){this.element.addEventListener(e,t),this.eventListeners.push({type:e,fn:t})}dispose(){this.eventListeners.forEach(({type:e,fn:t})=>{this.element.removeEventListener(e,t)}),this.eventListeners.length=0,this.element=null}}var T=function(r,e){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},T(r,e)};function p(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");T(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function B(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function m(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return s}function y(r,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return r.concat(s||Array.prototype.slice.call(e))}function c(r){return typeof r=="function"}function z(r){var e=function(i){Error.call(i),i.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var O=z(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(i,n){return n+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function C(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var S=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,i,n,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var u=B(o),a=u.next();!a.done;a=u.next()){var h=a.value;h.remove(this)}}catch(l){e={error:l}}finally{try{a&&!a.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}else o.remove(this);var d=this.initialTeardown;if(c(d))try{d()}catch(l){s=l instanceof O?l.errors:[l]}var G=this._finalizers;if(G){this._finalizers=null;try{for(var I=B(G),v=I.next();!v.done;v=I.next()){var xt=v.value;try{V(xt)}catch(l){s=s!=null?s:[],l instanceof O?s=y(y([],m(s)),m(l.errors)):s.push(l)}}}catch(l){i={error:l}}finally{try{v&&!v.done&&(n=I.return)&&n.call(I)}finally{if(i)throw i.error}}}if(s)throw new O(s)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)V(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&C(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&C(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}(),$=S.EMPTY;function R(r){return r instanceof S||r&&"closed"in r&&c(r.remove)&&c(r.add)&&c(r.unsubscribe)}function V(r){c(r)?r():r.unsubscribe()}var E={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},g={setTimeout:function(r,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];var n=g.delegate;return n!=null&&n.setTimeout?n.setTimeout.apply(n,y([r,e],m(t))):setTimeout.apply(void 0,y([r,e],m(t)))},clearTimeout:function(r){var e=g.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0};function Q(r){g.setTimeout(function(){throw r})}function k(){}var tt=function(){return F("C",void 0,void 0)}();function et(r){return F("E",void 0,r)}function rt(r){return F("N",r,void 0)}function F(r,e,t){return{kind:r,value:e,error:t}}var w=null;function _(r){if(E.useDeprecatedSynchronousErrorHandling){var e=!w;if(e&&(w={errorThrown:!1,error:null}),r(),e){var t=w,i=t.errorThrown,n=t.error;if(w=null,i)throw n}}else r()}var N=function(r){p(e,r);function e(t){var i=r.call(this)||this;return i.isStopped=!1,t?(i.destination=t,R(t)&&t.add(i)):i.destination=ot,i}return e.create=function(t,i,n){return new A(t,i,n)},e.prototype.next=function(t){this.isStopped?j(rt(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?j(et(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?j(tt,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(S),it=Function.prototype.bind;function P(r,e){return it.call(r,e)}var nt=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(i){L(i)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(i){L(i)}else L(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){L(t)}},r}(),A=function(r){p(e,r);function e(t,i,n){var s=r.call(this)||this,o;if(c(t)||!t)o={next:t!=null?t:void 0,error:i!=null?i:void 0,complete:n!=null?n:void 0};else{var u;s&&E.useDeprecatedNextContext?(u=Object.create(t),u.unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&P(t.next,u),error:t.error&&P(t.error,u),complete:t.complete&&P(t.complete,u)}):o=t}return s.destination=new nt(o),s}return e}(N);function L(r){Q(r)}function st(r){throw r}function j(r,e){var t=E.onStoppedNotification;t&&g.setTimeout(function(){return t(r,e)})}var ot={closed:!0,next:k,error:st,complete:k},ut=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function J(r){return r}function at(r){return r.length===0?J:r.length===1?r[0]:function(t){return r.reduce(function(i,n){return n(i)},t)}}var X=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,i){var n=this,s=ct(e)?e:new A(e,t,i);return _(function(){var o=n,u=o.operator,a=o.source;s.add(u?u.call(s,a):a?n._subscribe(s):n._trySubscribe(s))}),s},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var i=this;return t=q(t),new t(function(n,s){var o=new A({next:function(u){try{e(u)}catch(a){s(a),o.unsubscribe()}},error:s,complete:n});i.subscribe(o)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[ut]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return at(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=q(e),new e(function(i,n){var s;t.subscribe(function(o){return s=o},function(o){return n(o)},function(){return i(s)})})},r.create=function(e){return new r(e)},r}();function q(r){var e;return(e=r!=null?r:E.Promise)!==null&&e!==void 0?e:Promise}function lt(r){return r&&c(r.next)&&c(r.error)&&c(r.complete)}function ct(r){return r&&r instanceof N||lt(r)&&R(r)}function ht(r){return c(r==null?void 0:r.lift)}function ft(r){return function(e){if(ht(e))return e.lift(function(t){try{return r(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function pt(r,e,t,i,n){return new dt(r,e,t,i,n)}var dt=function(r){p(e,r);function e(t,i,n,s,o,u){var a=r.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=u,a._next=i?function(h){try{i(h)}catch(d){t.error(d)}}:r.prototype._next,a._error=s?function(h){try{s(h)}catch(d){t.error(d)}finally{this.unsubscribe()}}:r.prototype._error,a._complete=n?function(){try{n()}catch(h){t.error(h)}finally{this.unsubscribe()}}:r.prototype._complete,a}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;r.prototype.unsubscribe.call(this),!i&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(N),vt=z(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),K=function(r){p(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var i=new Y(this,this);return i.operator=t,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new vt},e.prototype.next=function(t){var i=this;_(function(){var n,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var o=B(i.currentObservers),u=o.next();!u.done;u=o.next()){var a=u.value;a.next(t)}}catch(h){n={error:h}}finally{try{u&&!u.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}}})},e.prototype.error=function(t){var i=this;_(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=t;for(var n=i.observers;n.length;)n.shift().error(t)}})},e.prototype.complete=function(){var t=this;_(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var i=t.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var i=this,n=this,s=n.hasError,o=n.isStopped,u=n.observers;return s||o?$:(this.currentObservers=null,u.push(t),new S(function(){i.currentObservers=null,C(u,t)}))},e.prototype._checkFinalizedStatuses=function(t){var i=this,n=i.hasError,s=i.thrownError,o=i.isStopped;n?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new X;return t.source=this,t},e.create=function(t,i){return new Y(t,i)},e}(X),Y=function(r){p(e,r);function e(t,i){var n=r.call(this)||this;return n.destination=t,n.source=i,n}return e.prototype.next=function(t){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.next)===null||n===void 0||n.call(i,t)},e.prototype.error=function(t){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.error)===null||n===void 0||n.call(i,t)},e.prototype.complete=function(){var t,i;(i=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||i===void 0||i.call(t)},e.prototype._subscribe=function(t){var i,n;return(n=(i=this.source)===null||i===void 0?void 0:i.subscribe(t))!==null&&n!==void 0?n:$},e}(K),bt=function(r){p(e,r);function e(t){var i=r.call(this)||this;return i._value=t,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var i=r.prototype._subscribe.call(this,t);return!i.closed&&t.next(this._value),i},e.prototype.getValue=function(){var t=this,i=t.hasError,n=t.thrownError,s=t._value;if(i)throw n;return this._throwIfClosed(),s},e.prototype.next=function(t){r.prototype.next.call(this,this._value=t)},e}(K);function mt(r,e){return e===void 0&&(e=J),r=r!=null?r:yt,ft(function(t,i){var n,s=!0;t.subscribe(pt(i,function(o){var u=e(o);(s||!r(n,u))&&(s=!1,n=u,i.next(o))}))})}function yt(r,e){return r===e}var St=Object.defineProperty,Z=Object.getOwnPropertySymbols,Et=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable,W=(r,e,t)=>e in r?St(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,M=(r,e)=>{for(var t in e||(e={}))Et.call(e,t)&&W(r,t,e[t]);if(Z)for(var t of Z(e))gt.call(e,t)&&W(r,t,e[t]);return r};class U{constructor(e){this.lastBroadcastedState=null,this.lastBroadcastedState=M({},e),this.compareState=this.defaultCompareState,this.stateSource=new bt(this.lastBroadcastedState),this._state$=this.stateSource.pipe(mt(this.compareState))}static areEqualShallow(e,t){for(let i in e)if(!(i in t)||e[i]!==t[i])return!1;for(let i in t)if(!(i in e))return!1;return!0}get state$(){return this._state$}setState(e){this.lastBroadcastedState=M(M({},this.lastBroadcastedState),e),this.stateSource.next(this.lastBroadcastedState)}defaultCompareState(e,t){return U.areEqualShallow(e,t)}}function wt(r,e){if(!r||!e||!r.contains(e))return null;if(r===e)return[r];const t=[e];let i=e;for(;i.parentNode&&i.parentNode!==r;)i=i.parentNode,t.unshift(i);return t.unshift(r),t}class _t{constructor(e,t={}){this.inputElement=e,this.options=t,this.browserEventManager=null,this.browserEventManager=new x(this.inputElement),this.browserEventManager.addListener("focus",()=>{this.options.onFocus&&this.options.onFocus()}),this.browserEventManager.addListener("blur",()=>{this.options.onBlur&&this.options.onBlur()}),this.browserEventManager.addListener("input",i=>{const n=i.target;this.options.onValueChange&&this.options.onValueChange(n.value)})}setFocus(){this.inputElement.focus()}dispose(){this.inputElement=null,this.browserEventManager.dispose()}}class D{constructor(e,t,i={}){this.inputElement=e,this.itemTemplate=t,this.options=i,this.listElementEvents=null,this.documentEvents=null,this.listElement=null,this.items=[],this.visible=!1,this.isFocused=!1,this.initializeListElement(),this.listElementEvents=new x(this.listElement),this.documentEvents=new x(window.document.documentElement),this.listElement.style.position="fixed",this.listElement.style.zIndex=String(10),this.listElementEvents.addListener("mousedown",n=>{this.setFocus()}),this.listElementEvents.addListener("click",n=>{const s=n.target;if(s instanceof HTMLElement){const o=this.getSelectedItem(s);this.options.onItemSelect(o)}}),this.documentEvents.addListener("mousedown",n=>{const s=n.target;this.isFocused&&!this.listElement.contains(s)&&this.blur()})}static escapeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}setItems(e){const{searchBoxList:{messageClassName:t}}=f;this.clearList(),e.length?(this.items=e,this.items.forEach((i,n)=>{this.listElement.appendChild(this.createListItem(i,n))})):this.listElement.innerHTML=`<div class="${t}">${H.noResultsFound}</div>`}beginLoading(){const{searchBoxList:{messageClassName:e,loadingIndicatorClassName:t}}=f;this.clearList(),this.listElement.innerHTML=`
            <div class="${e}">
                <div class="${t}"></div>
                ${H.loading}
            </div>
        `}show(){const{bottom:e,right:t}=this.inputElement.getBoundingClientRect(),i=document.documentElement.clientWidth;this.listElement.style.display="block",this.listElement.style.top=`${e}px`,this.listElement.style.right=`${i-t}px`,this.visible=!0}hide(){this.visible&&(this.visible=!1,this.listElement.style.display="none",this.blur())}setFocus(){this.isFocused||(this.isFocused=!0,this.options.onFocus&&this.options.onFocus())}blur(){this.isFocused&&(this.isFocused=!1,this.options.onBlur&&this.options.onBlur())}dispose(){this.inputElement=null,this.listElementEvents.dispose(),this.documentEvents.dispose()}getSelectedItem(e){const{searchBoxList:{itemButtonDefaultClassName:t}}=f,i=wt(this.listElement,e),n=i==null?void 0:i.find(s=>s.tagName==="BUTTON"&&s.classList.contains(t));if((n==null?void 0:n.tagName)==="BUTTON"&&n.classList.contains(t)){const s=typeof(n==null?void 0:n.dataset.index)=="string"?Number(n.dataset.index):null;return this.items[s]||null}else return null}clearList(){this.items=[],this.listElement.innerHTML=""}initializeListElement(){const{searchBoxList:{defaultClassName:e}}=f;this.listElement=document.createElement("ul"),this.listElement.classList.add(e),this.listElement.style.display="none",document.body.append(this.listElement),this.beginLoading()}createListItem(e,t){const i=document.createElement("li"),n=document.createElement("button"),s=this.getItemHTML(e,this.itemTemplate),{searchBoxList:{itemButtonDefaultClassName:o,itemDefaultClassName:u}}=f;return n.setAttribute("data-index",String(t)),n.setAttribute("type","button"),n.innerHTML=s,n.classList.add(o),i.appendChild(n),i.classList.add(u),i}getItemHTML(e,t){return t.replace(/{{(.+)}}/g,(i,n)=>{var s;const o=n.trim(),u=(s=e[o])!=null?s:null,a=u===null?"":String(u);return D.escapeHTML(a)})}}class Lt{constructor(e,t,i,n,s={}){if(this.inputElement=e,this.dataSource=t,this.itemTemplate=i,this.searchKeys=n,this.options=s,this.input=null,this.resultList=null,this.isInitializing=!1,this.isInitialized=!1,this.state=null,!(e instanceof HTMLInputElement))throw new Error("Input element must be a valid HTMLInputElement!");e.classList.add(f.searchBoxInput.defaultClassName),this.state=new U({inputFocused:!1,resultListFocused:!1,inputValue:"",selectedItem:null}),this.input=new _t(e,{onFocus:()=>this.state.setState({inputFocused:!0,resultListFocused:!1}),onBlur:()=>this.state.setState({inputFocused:!1}),onValueChange:o=>this.state.setState({inputValue:o})}),this.resultList=new D(e,i,{onFocus:()=>this.state.setState({resultListFocused:!0}),onBlur:()=>this.state.setState({resultListFocused:!1}),onItemSelect:o=>this.state.setState({selectedItem:o})}),this.stateSubscription=this.state.state$.subscribe(o=>this.onStateChange(o))}dispose(){this.input.dispose(),this.resultList.dispose(),this.inputElement=null,this.stateSubscription.unsubscribe()}initialize(){this.isInitializing=!0,this.dataSource.getItems("",10,this.searchKeys).then(e=>{this.resultList.setItems(e),this.isInitialized=!0,this.isInitializing=!1})}onStateChange(e){console.log("state changed",e),e.selectedItem&&this.options.onItemSelect&&this.options.onItemSelect(e.selectedItem),e.inputFocused?(!this.isInitializing&&!this.isInitialized&&this.initialize(),this.resultList.show()):e.resultListFocused||this.resultList.hide()}}class It{constructor(e){this.url=e,this.items=null}getItems(e,t,i){return this.items||(this.items=this.waitForIt(3e3).then(()=>this.fetchJSON(this.url))),this.items.then(n=>this.filterItems(n,e,i))}async fetchJSON(e){return fetch(e).then(t=>{if(t.ok)return t.json();throw new Error(`Request to fetch JSON data for the SearchBox has failed with status code ${t.status}`)})}filterItems(e,t,i){return t.length<2?e:(t=t.toLowerCase(),e.filter(n=>i.some(s=>{const o=n[s];return o&&String(o).toLowerCase().includes(t)})))}waitForIt(e){return new Promise(t=>{setTimeout(()=>t(),e)})}}return b.SearchBox=Lt,b.SearchBoxJSONDataSource=It,Object.defineProperty(b,"__esModule",{value:!0}),b}({});
//# sourceMappingURL=searchboxjs.min.js.map
