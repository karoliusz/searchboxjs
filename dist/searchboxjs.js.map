{"version":3,"file":"searchboxjs.js","sources":["../src/ts/utils/State.ts","../src/ts/SearchBox.ts"],"sourcesContent":["import { BehaviorSubject, distinctUntilChanged, Observable } from 'rxjs';\r\n\r\nimport { StateCompareFn } from '../interfaces';\r\n\r\nexport class State<T extends object> {\r\n    static areEqualShallow(a: object, b: object): boolean {\r\n        for (let key in a) {\r\n            if (!(key in b) || a[key] !== b[key]) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        for (let key in b) {\r\n            if (!(key in a)) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private lastBroadcastedState: T = null;\r\n    private compareState: StateCompareFn<T>;\r\n\r\n    private stateSource: BehaviorSubject<T>;\r\n    private _state$: Observable<T>;\r\n\r\n    public get state$(): Observable<T> {\r\n        return this._state$;\r\n    }\r\n\r\n    constructor(initialState: T) {\r\n        this.lastBroadcastedState = { ...initialState };\r\n        this.compareState = this.defaultCompareState;\r\n        this.stateSource = new BehaviorSubject(this.lastBroadcastedState);\r\n        this._state$ = this.stateSource.pipe(\r\n            distinctUntilChanged(this.compareState)\r\n        );\r\n    }\r\n\r\n    public setState(state: Partial<T>): void {\r\n        this.lastBroadcastedState = { ...this.lastBroadcastedState, ...state };\r\n        this.stateSource.next(this.lastBroadcastedState);\r\n    }\r\n\r\n    private defaultCompareState(a: T, b: T): boolean {\r\n        return State.areEqualShallow(a, b);\r\n    }\r\n}\r\n","import { Subscription } from \"rxjs\";\r\nimport { SearchBoxDataSource } from \"./dataLayer/interfaces\";\r\nimport { SearchBoxOptions } from \"./interfaces\";\r\nimport { State } from \"./utils\";\r\n\r\ninterface SearchBoxState<T = unknown> {\r\n    inputFocused: boolean;\r\n    resultListFocused: boolean;\r\n    inputValue: string;\r\n    selectedItem: T\r\n}\r\n\r\n/**\r\n * SearchBox component\r\n * \r\n * @param itemTemplate Provides HTML template for found items. Parameter names enclosed with {{ and }} will be replaced with their values from the item object. Example: <span class=\"itemName\">{{name}}</span>\r\n */\r\nexport class SearchBox<T> {\r\n    // private input: SearchBoxInput = null;\r\n    // private resultList: SearchBoxResultList<T> = null;\r\n    // private isInitializing = false;\r\n    // private isInitialized = false;\r\n\r\n    private state: State<SearchBoxState<T>> = null;\r\n    private stateSubscription: Subscription;\r\n\r\n    constructor(\r\n        private inputElement: HTMLElement,\r\n        private dataSource: SearchBoxDataSource<T>,\r\n        private itemTemplate: string,\r\n        private searchKeys: Array<keyof T>,\r\n        private options: SearchBoxOptions<T> = {}) {\r\n\r\n        if (!(inputElement instanceof HTMLInputElement)) {\r\n            throw new Error('Input element must be a valid HTMLInputElement!');\r\n        }\r\n\r\n        this.state = new State<SearchBoxState<T>>({\r\n            inputFocused: false,\r\n            resultListFocused: false,\r\n            inputValue: '',\r\n            selectedItem: null\r\n        });\r\n\r\n        // this.input = new SearchBoxInput(inputElement, {\r\n        //     onFocus: () => this.state.setState({ inputFocused: true, resultListFocused: false }),\r\n        //     onBlur: () => this.state.setState({ inputFocused: false }),\r\n        //     onValueChange: value => this.state.setState({ inputValue: value })\r\n        // });\r\n\r\n        // this.resultList = new SearchBoxResultList(inputElement, itemTemplate, {\r\n        //     onFocus: () => this.state.setState({ resultListFocused: true }),\r\n        //     onBlur: () => this.state.setState({ resultListFocused: false }),\r\n        //     onItemSelect: item => this.state.setState({ selectedItem: item })\r\n        // });\r\n\r\n        this.stateSubscription = this.state.state$.subscribe(event => this.onStateChange(event));\r\n    }\r\n\r\n    dispose() {\r\n        // this.input.dispose();\r\n        // this.resultList.dispose();\r\n        this.inputElement = null;\r\n        this.stateSubscription.unsubscribe();\r\n    }\r\n\r\n    private initialize() {\r\n        // this.isInitializing = true;\r\n\r\n        this.dataSource.getItems('', 10, this.searchKeys)\r\n            .then(data => {\r\n                // this.resultList.setItems(data);\r\n                // this.isInitialized = true;\r\n                // this.isInitializing = false;\r\n            });\r\n    }\r\n\r\n    private onStateChange(event: SearchBoxState<T>) {\r\n        console.log('state changed', event);\r\n\r\n        if (event.selectedItem && this.options.onItemSelect) {\r\n            this.options.onItemSelect(event.selectedItem);\r\n        }\r\n\r\n        // if (event.inputFocused) {\r\n        //     if (!this.isInitializing && !this.isInitialized) {\r\n        //         this.initialize();\r\n        //     }\r\n\r\n        //     this.resultList.show();\r\n        // } else if (!event.resultListFocused) {\r\n        //     this.resultList.hide();\r\n        // }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}