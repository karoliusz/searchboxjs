var SearchBoxJS=function(){"use strict";class M{constructor(e){this.element=e,this.eventListeners=[]}addListener(e,t){this.element.addEventListener(e,t),this.eventListeners.push({type:e,fn:t})}dispose(){this.eventListeners.forEach(({type:e,fn:t})=>{this.element.removeEventListener(e,t)}),this.eventListeners.length=0,this.element=null}}var T=function(r,e){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},T(r,e)};function f(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");T(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function I(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function b(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(u){o={error:u}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function m(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))}function c(r){return typeof r=="function"}function H(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var x=H(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function O(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var y=function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var u=I(o),l=u.next();!l.done;l=u.next()){var h=l.value;h.remove(this)}}catch(a){e={error:a}}finally{try{l&&!l.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}else o.remove(this);var p=this.initialTeardown;if(c(p))try{p()}catch(a){s=a instanceof x?a.errors:[a]}var Z=this._finalizers;if(Z){this._finalizers=null;try{for(var L=I(Z),v=L.next();!v.done;v=L.next()){var Lt=v.value;try{z(Lt)}catch(a){s=s!=null?s:[],a instanceof x?s=m(m([],b(s)),b(a.errors)):s.push(a)}}}catch(a){n={error:a}}finally{try{v&&!v.done&&(i=L.return)&&i.call(L)}finally{if(n)throw n.error}}}if(s)throw new x(s)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)z(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&O(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&O(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=function(){var e=new r;return e.closed=!0,e}(),r}(),D=y.EMPTY;function $(r){return r instanceof y||r&&"closed"in r&&c(r.remove)&&c(r.add)&&c(r.unsubscribe)}function z(r){c(r)?r():r.unsubscribe()}var S={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},E={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];var i=E.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,m([r,e],b(t))):setTimeout.apply(void 0,m([r,e],b(t)))},clearTimeout:function(r){var e=E.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(r)},delegate:void 0};function G(r){E.setTimeout(function(){throw r})}function R(){}var Q=function(){return B("C",void 0,void 0)}();function tt(r){return B("E",void 0,r)}function et(r){return B("N",r,void 0)}function B(r,e,t){return{kind:r,value:e,error:t}}var g=null;function _(r){if(S.useDeprecatedSynchronousErrorHandling){var e=!g;if(e&&(g={errorThrown:!1,error:null}),r(),e){var t=g,n=t.errorThrown,i=t.error;if(g=null,n)throw i}}else r()}var C=function(r){f(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,$(t)&&t.add(n)):n.destination=st,n}return e.create=function(t,n,i){return new P(t,n,i)},e.prototype.next=function(t){this.isStopped?A(et(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?A(tt(t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?A(Q,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(y),rt=Function.prototype.bind;function F(r,e){return rt.call(r,e)}var nt=function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){w(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){w(n)}else w(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){w(t)}},r}(),P=function(r){f(e,r);function e(t,n,i){var s=r.call(this)||this,o;if(c(t)||!t)o={next:t!=null?t:void 0,error:n!=null?n:void 0,complete:i!=null?i:void 0};else{var u;s&&S.useDeprecatedNextContext?(u=Object.create(t),u.unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&F(t.next,u),error:t.error&&F(t.error,u),complete:t.complete&&F(t.complete,u)}):o=t}return s.destination=new nt(o),s}return e}(C);function w(r){G(r)}function it(r){throw r}function A(r,e){var t=S.onStoppedNotification;t&&E.setTimeout(function(){return t(r,e)})}var st={closed:!0,next:R,error:it,complete:R},ot=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function k(r){return r}function ut(r){return r.length===0?k:r.length===1?r[0]:function(t){return r.reduce(function(n,i){return i(n)},t)}}var K=function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var i=this,s=at(e)?e:new P(e,t,n);return _(function(){var o=i,u=o.operator,l=o.source;s.add(u?u.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=V(t),new t(function(i,s){var o=new P({next:function(u){try{e(u)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});n.subscribe(o)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[ot]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ut(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=V(e),new e(function(n,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},r.create=function(e){return new r(e)},r}();function V(r){var e;return(e=r!=null?r:S.Promise)!==null&&e!==void 0?e:Promise}function lt(r){return r&&c(r.next)&&c(r.error)&&c(r.complete)}function at(r){return r&&r instanceof C||lt(r)&&$(r)}function ct(r){return c(r==null?void 0:r.lift)}function ht(r){return function(e){if(ct(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function ft(r,e,t,n,i){return new pt(r,e,t,n,i)}var pt=function(r){f(e,r);function e(t,n,i,s,o,u){var l=r.call(this,t)||this;return l.onFinalize=o,l.shouldUnsubscribe=u,l._next=n?function(h){try{n(h)}catch(p){t.error(p)}}:r.prototype._next,l._error=s?function(h){try{s(h)}catch(p){t.error(p)}finally{this.unsubscribe()}}:r.prototype._error,l._complete=i?function(){try{i()}catch(h){t.error(h)}finally{this.unsubscribe()}}:r.prototype._complete,l}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;r.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(C),dt=H(function(r){return function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Y=function(r){f(e,r);function e(){var t=r.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var n=new q(this,this);return n.operator=t,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new dt},e.prototype.next=function(t){var n=this;_(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var o=I(n.currentObservers),u=o.next();!u.done;u=o.next()){var l=u.value;l.next(t)}}catch(h){i={error:h}}finally{try{u&&!u.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(t){var n=this;_(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=t;for(var i=n.observers;i.length;)i.shift().error(t)}})},e.prototype.complete=function(){var t=this;_(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var n=t.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),r.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var n=this,i=this,s=i.hasError,o=i.isStopped,u=i.observers;return s||o?D:(this.currentObservers=null,u.push(t),new y(function(){n.currentObservers=null,O(u,t)}))},e.prototype._checkFinalizedStatuses=function(t){var n=this,i=n.hasError,s=n.thrownError,o=n.isStopped;i?t.error(s):o&&t.complete()},e.prototype.asObservable=function(){var t=new K;return t.source=this,t},e.create=function(t,n){return new q(t,n)},e}(K),q=function(r){f(e,r);function e(t,n){var i=r.call(this)||this;return i.destination=t,i.source=n,i}return e.prototype.next=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,t)},e.prototype.error=function(t){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,t)},e.prototype.complete=function(){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||n===void 0||n.call(t)},e.prototype._subscribe=function(t){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(t))!==null&&i!==void 0?i:D},e}(Y),vt=function(r){f(e,r);function e(t){var n=r.call(this)||this;return n._value=t,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var n=r.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},e.prototype.getValue=function(){var t=this,n=t.hasError,i=t.thrownError,s=t._value;if(n)throw i;return this._throwIfClosed(),s},e.prototype.next=function(t){r.prototype.next.call(this,this._value=t)},e}(Y);function bt(r,e){return e===void 0&&(e=k),r=r!=null?r:mt,ht(function(t,n){var i,s=!0;t.subscribe(ft(n,function(o){var u=e(o);(s||!r(i,u))&&(s=!1,i=u,n.next(o))}))})}function mt(r,e){return r===e}var yt=Object.defineProperty,X=Object.getOwnPropertySymbols,St=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable,J=(r,e,t)=>e in r?yt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,j=(r,e)=>{for(var t in e||(e={}))St.call(e,t)&&J(r,t,e[t]);if(X)for(var t of X(e))Et.call(e,t)&&J(r,t,e[t]);return r};class N{constructor(e){this.lastBroadcastedState=null,this.lastBroadcastedState=j({},e),this.compareState=this.defaultCompareState,this.stateSource=new vt(this.lastBroadcastedState),this._state$=this.stateSource.pipe(bt(this.compareState))}static areEqualShallow(e,t){for(let n in e)if(!(n in t)||e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}get state$(){return this._state$}setState(e){this.lastBroadcastedState=j(j({},this.lastBroadcastedState),e),this.stateSource.next(this.lastBroadcastedState)}defaultCompareState(e,t){return N.areEqualShallow(e,t)}}function gt(r,e){if(!r||!e||!r.contains(e))return null;if(r===e)return[r];const t=[e];let n=e;for(;n.parentNode&&n.parentNode!==r;)n=n.parentNode,t.unshift(n);return t.unshift(r),t}const _t=10,d={searchBoxList:{defaultClassName:"searchBoxList",itemDefaultClassName:"searchBoxList__item",itemButtonDefaultClassName:"searchBoxList__itemButton",messageClassName:"searchBoxList__message",loadingIndicatorClassName:"searchBoxList__loadingIndicator"}},W={noResultsFound:"Sorry, can't find a match for your search phrase!",loading:"Loading your results\u2026"};class U{constructor(e,t,n={}){this.inputElement=e,this.itemTemplate=t,this.options=n,this.listElementEvents=null,this.documentEvents=null,this.listElement=null,this.items=[],this.visible=!1,this.isFocused=!1,this.initializeListElement(),this.listElementEvents=new M(this.listElement),this.documentEvents=new M(window.document.documentElement),this.listElement.style.position="fixed",this.listElement.style.zIndex=String(_t),this.listElementEvents.addListener("mousedown",i=>{this.setFocus()}),this.listElementEvents.addListener("click",i=>{const s=i.target;if(s instanceof HTMLElement){const o=this.getSelectedItem(s);this.options.onItemSelect(o)}}),this.documentEvents.addListener("mousedown",i=>{const s=i.target;this.isFocused&&!this.listElement.contains(s)&&this.blur()})}static escapeHTML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}setItems(e){const{searchBoxList:{messageClassName:t}}=d;this.clearList(),e.length?(this.items=e,this.items.forEach((n,i)=>{this.listElement.appendChild(this.createListItem(n,i))})):this.listElement.innerHTML=`<div class="${t}">${W.noResultsFound}</div>`}beginLoading(){const{searchBoxList:{messageClassName:e,loadingIndicatorClassName:t}}=d;this.clearList(),this.listElement.innerHTML=`
            <div class="${e}">
                <div class="${t}"></div>
                ${W.loading}
            </div>
        `}show(){const{bottom:e,right:t}=this.inputElement.getBoundingClientRect(),n=document.documentElement.clientWidth;this.listElement.style.display="block",this.listElement.style.top=`${e}px`,this.listElement.style.right=`${n-t}px`,this.visible=!0}hide(){this.visible&&(this.visible=!1,this.listElement.style.display="none",this.blur())}setFocus(){this.isFocused||(this.isFocused=!0,this.options.onFocus&&this.options.onFocus())}blur(){this.isFocused&&(this.isFocused=!1,this.options.onBlur&&this.options.onBlur())}dispose(){this.inputElement=null,this.listElementEvents.dispose(),this.documentEvents.dispose()}getSelectedItem(e){const{searchBoxList:{itemButtonDefaultClassName:t}}=d,n=gt(this.listElement,e),i=n==null?void 0:n.find(s=>s.tagName==="BUTTON"&&s.classList.contains(t));if((i==null?void 0:i.tagName)==="BUTTON"&&i.classList.contains(t)){const s=typeof(i==null?void 0:i.dataset.index)=="string"?Number(i.dataset.index):null;return this.items[s]||null}else return null}clearList(){this.items=[],this.listElement.innerHTML=""}initializeListElement(){const{searchBoxList:{defaultClassName:e}}=d;this.listElement=document.createElement("ul"),this.listElement.classList.add(e),this.listElement.style.display="none",document.body.append(this.listElement),this.beginLoading()}createListItem(e,t){const n=document.createElement("li"),i=document.createElement("button"),s=this.getItemHTML(e,this.itemTemplate),{searchBoxList:{itemButtonDefaultClassName:o,defaultClassName:u}}=d;return i.setAttribute("data-index",String(t)),i.setAttribute("type","button"),i.innerHTML=s,i.classList.add(o),n.appendChild(i),n.classList.add(u),n}getItemHTML(e,t){return t.replace(/{{(.+)}}/g,(n,i)=>{var s;const o=i.trim(),u=(s=e[o])!=null?s:null,l=u===null?"":String(u);return U.escapeHTML(l)})}}class wt{constructor(e,t,n,i,s={}){if(this.inputElement=e,this.dataSource=t,this.itemTemplate=n,this.searchKeys=i,this.options=s,this.resultList=null,this.isInitializing=!1,this.isInitialized=!1,this.state=null,!(e instanceof HTMLInputElement))throw new Error("Input element must be a valid HTMLInputElement!");this.state=new N({inputFocused:!1,resultListFocused:!1,inputValue:"",selectedItem:null}),this.resultList=new U(e,n,{onFocus:()=>this.state.setState({resultListFocused:!0}),onBlur:()=>this.state.setState({resultListFocused:!1}),onItemSelect:o=>this.state.setState({selectedItem:o})}),this.stateSubscription=this.state.state$.subscribe(o=>this.onStateChange(o))}dispose(){this.resultList.dispose(),this.inputElement=null,this.stateSubscription.unsubscribe()}initialize(){this.isInitializing=!0,this.dataSource.getItems("",10,this.searchKeys).then(e=>{this.resultList.setItems(e),this.isInitialized=!0,this.isInitializing=!1})}onStateChange(e){console.log("state changed",e),e.selectedItem&&this.options.onItemSelect&&this.options.onItemSelect(e.selectedItem)}}return wt}();
//# sourceMappingURL=searchboxjs.min.js.map
